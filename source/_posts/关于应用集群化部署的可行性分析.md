---
title: 关于应用集群化部署的可行性分析
date: 2017-05-09 15:59:10
tags: ['并发','高可用','负载均衡','集群']
categories: 架构
---

### 1.问题背景
Center经常在高峰期（一般在下午2点到5点）出现卡顿，请求堵塞在MQ的情况，严重影响业务和用户体验。
### 2.初步分析
目前的部署架构如图所示：
![](http://ooxz0ztfx.bkt.clouddn.com/pssnow.png)
可以看出只有一个消费者（Center应用）在处理业务请求。在高峰期，处理速度远小于生产者将请求放入MQ的速度，导致请求在MQ中堆积，不能及时消费处理，结果就是系统响应缓慢，各种接口调用超时。
### 3.解决方案
将Center集群化部署，提高消息的处理能力，并增强服务的高可用性。如图所示，目前先再部署多一个，后面根据业务的增长可以水平再扩展到N个。
![](http://ooxz0ztfx.bkt.clouddn.com/pssfuture.png)
### 4.解决方案的可行性分析
Center可以轻松地水平扩展主要依赖于以下几点：
- **请求消息的无状态性**

无状态服务(stateless service)指的是对单次请求的处理，不依赖其他请求，也就是说，处理一次请求所需的全部信息，要么都包含在这个请求里，要么可以从外部获取到（比如说数据库），服务器本身不存储任何信息 。
- **请求消息的无序性**

无序性指的是请求消息不必按顺序依次消费处理。Center使用线程池来处理请求可以得出这个结论，因为每个线程获得CPU时间是随机的，所以对请求的处理是无序的。
- **其他**

Center自身没有任何的定时任务需要执行，不用考虑定时任务重复执行的问题。
### 5.方案实施
#### 5.1单机多应用部署
即拷贝多一份完整应用，并修改相关的脚本
此方案的优点是简单，不用占用新服务器资源，IP没有变化，不用考虑外部接口对IP的限制问题。缺点是共用服务器资源，性能效果没有最优。
#### 5.2多机部署
在新的服务器上部署。此方案的优点是独占服务器资源，缺点是IP变化了，要考虑外部接口对IP限制的问题。
### 6.拓展：高可用部署
考虑到业务的日益增长，当前的瓶颈是Center的处理速度,以后的瓶颈可能是Web服务器，MQ，数据库,网络等等，对此提供一份部署方案参考。
![](http://ooxz0ztfx.bkt.clouddn.com/pssha2.png)